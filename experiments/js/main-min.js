"use strict";function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(i,a){try{var o=t[i](a),s=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}return r("next")})}}!function(){var e=426,t=240,n=["user",{exact:"environment"}],r=void 0,i=0,a=0,o={audio:!1,video:{width:1280,height:720}};document.addEventListener("DOMContentLoaded",function(e){var t=this,i=document.getElementById("js-media-Resource-file"),a=document.getElementById("js-media_Camera"),s=document.getElementById("js-media_Canvas"),c=document.getElementById("js-cntl_Btn-shooting"),d=document.getElementById("js-cntl_Btn-toggle"),u=document.getElementById("js-result_ImgContainer"),m=document.getElementById("js-result-Data-emotion"),f=s.getContext("2d"),l=void 0;s.width=s.clientWidth,s.height=s.clientHeight;var v=function e(n){n.preventDefault(),i.classList.remove("media-Resource-dragover");var r=n.dataTransfer||n.target,a=r&&r.files&&r.files[0];if(!a||"image/jpeg"!==a.type&&"image/png"!==a.type)return void alert("適切なファイルが指定されていません");loadImage(a,function(e){var n=document.createElement("img");for(n.src=e.toDataURL("image/png");u.firstChild;)u.removeChild(u.firstChild);n.classList.add("result_Img","sw-Image-w_fluid"),u.appendChild(n),_asyncToGenerator(regeneratorRuntime.mark(function n(){var r,i,a;return regeneratorRuntime.wrap(function t(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,p({canvas:e});case 2:return r=n.sent,n.next=5,g({blob:r});case 5:return i=n.sent,n.next=8,h({blob:r});case 8:a=n.sent,m.innerHTML=JSON.stringify(i.data,"","    ")+JSON.stringify(a.data,"","    ");case 10:case"end":return n.stop()}},n,t)}))()},{canvas:!0,downsamplingRatio:.5,orientation:!0})},g=function e(t){return new Promise(function(e,n){axios({method:"POST",url:"https://westus.api.cognitive.microsoft.com/emotion/v1.0/recognize?visualFeatures=Categories、Description",headers:{"Content-Type":"application/octet-stream","Ocp-Apim-Subscription-Key":EMOTION_API_KEY},data:t.blob}).then(function(t){e(t)}).catch(function(t){e(t)})})},h=function e(t){return new Promise(function(e,n){axios({method:"POST",url:"https://westcentralus.api.cognitive.microsoft.com/vision/v1.0/analyze",headers:{"Content-Type":"application/octet-stream","Ocp-Apim-Subscription-Key":"20365278a878447aa2bed97605602d32"},data:t.blob}).then(function(t){e(t)}).catch(function(t){e(t)})})},p=function e(t){return new Promise(function(e,n){try{t.canvas.toBlob(function(t){e(t)})}catch(t){e(n)}})},w=function e(){var t=[];return new Promise(function(e,n){navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then(function(n){n.forEach(function(e){"videoinput"===e.kind&&t.push({name:e.label,id:e.deviceId})}),e(t)}):MediaStreamTrack.getSources(function(n){n.forEach(function(e){"video"===e.kind&&t.push({name:e.facing,id:e.id})}),e(t)})})},y=function e(){return new Promise(function(e,t){var n=new createjs.LoadQueue;createjs.Sound.alternateExtensions=["mp3"],n.installPlugin(createjs.Sound);var r=[{id:"shooting",type:createjs.Types.SOUND,src:"shared/sounds/shooting-0.mp3"}];n.setMaxConnections(6),n.addEventListener("error",function(e){t(e)}),n.addEventListener("complete",function(t){e(n)}),n.loadManifest(r)})},x=function e(){c.addEventListener("click",function(e){e.preventDefault();var n=window.devicePixelRatio||1,r=loadImage.scale(s,{top:s.height/2-120,left:s.width/2-213,sourceWidth:s.width,sourceHeight:s.height,minWidth:426,maxWidth:426,downsamplingRatio:.5});_asyncToGenerator(regeneratorRuntime.mark(function e(){var n,i,a;return regeneratorRuntime.wrap(function e(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p({canvas:r});case 2:return n=t.sent,t.next=5,g({blob:n});case 5:return i=t.sent,t.next=8,h({blob:n});case 8:a=t.sent,m.innerHTML=JSON.stringify(i.data,"","    ")+JSON.stringify(a.data,"","    ");case 10:case"end":return t.stop()}},e,t)}))();var i=document.createElement("img");for(i.classList.add("result_Img","sw-Image-w_fluid"),i.src=r.toDataURL("image/png");u.firstChild;)u.removeChild(u.firstChild);u.appendChild(i)}),i.addEventListener("dragover",function(e){e.preventDefault(),i.classList.add("media-Resource-dragover"),e.dataTransfer.dropEffect="copy"}),i.addEventListener("dragleave",function(e){e.preventDefault(),i.classList.remove("media-Resource-dragover")}),i.addEventListener("drop",v)};!function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function e(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,w();case 3:return l=i.sent,o.video.facingMode=n[0],i.next=7,navigator.mediaDevices.getUserMedia(o);case 7:return r=i.sent,i.next=10,y();case 10:t=i.sent,x(),a.srcObject=r,function e(){f.drawImage(a,0,0,s.width,s.height),requestAnimationFrame(e)}(),i.next=19;break;case 16:i.prev=16,i.t0=i.catch(0),console.log(i.t0);case 19:case"end":return i.stop()}},e,this,[[0,16]])}));return e}()()},!1)}();