"use strict";function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function i(r,o){try{var a=t[r](o),c=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(c).then(function(e){i("next",e)},function(e){i("throw",e)});e(c)}return i("next")})}}!function(){var e=426,t=240,n=["user",{exact:"environment"}],i=void 0,r=0,o=0,a={audio:!1,video:{width:1280,height:720}};document.addEventListener("DOMContentLoaded",function(e){var t=this,r=document.getElementById("js-media-Resource-file"),o=document.getElementById("js-media_Camera"),c=document.getElementById("js-media_Canvas"),s=document.getElementById("js-cntl_Btn-shooting"),d=document.getElementById("js-cntl_Btn-toggle"),u=document.getElementById("js-result_ImgContainer"),m=document.getElementById("js-result-Data-emotion"),l=c.getContext("2d"),f=void 0;c.width=c.clientWidth,c.height=c.clientHeight;var v=function e(n){n.preventDefault(),r.classList.remove("media-Resource-dragover");var i=n.dataTransfer||n.target,o=i&&i.files&&i.files[0];if(!o||"image/jpeg"!==o.type&&"image/png"!==o.type)return void alert("適切なファイルが指定されていません");loadImage(o,function(e){var n=document.createElement("img");for(n.src=e.toDataURL("image/png");u.firstChild;)u.removeChild(u.firstChild);n.classList.add("result_Img","sw-Image-w_fluid"),u.appendChild(n),_asyncToGenerator(regeneratorRuntime.mark(function n(){var i,r;return regeneratorRuntime.wrap(function t(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,h({canvas:e});case 2:return i=n.sent,n.next=5,g({blob:i});case 5:r=n.sent,m.innerHTML=JSON.stringify(r.data,"","    ");case 7:case"end":return n.stop()}},n,t)}))()},{canvas:!0,downsamplingRatio:.5,orientation:!0})},g=function e(t){return new Promise(function(e,n){axios({method:"POST",url:"https://westus.api.cognitive.microsoft.com/emotion/v1.0/recognize",headers:{"Content-Type":"application/octet-stream","Ocp-Apim-Subscription-Key":EMOTION_API_KEY},data:t.blob}).then(function(t){e(t)}).catch(function(t){e(t)})})},h=function e(t){return new Promise(function(e,n){try{t.canvas.toBlob(function(t){e(t)})}catch(t){e(n)}})},p=function e(){var t=[];return new Promise(function(e,n){navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then(function(n){n.forEach(function(e){"videoinput"===e.kind&&t.push({name:e.label,id:e.deviceId})}),e(t)}):MediaStreamTrack.getSources(function(n){n.forEach(function(e){"video"===e.kind&&t.push({name:e.facing,id:e.id})}),e(t)})})},w=function e(){return new Promise(function(e,t){var n=new createjs.LoadQueue;createjs.Sound.alternateExtensions=["mp3"],n.installPlugin(createjs.Sound);var i=[{id:"shooting",type:createjs.Types.SOUND,src:"shared/sounds/shooting-0.mp3"}];n.setMaxConnections(6),n.addEventListener("error",function(e){t(e)}),n.addEventListener("complete",function(t){e(n)}),n.loadManifest(i)})},y=function e(){s.addEventListener("click",function(e){e.preventDefault();var t=window.devicePixelRatio||1,n=loadImage.scale(c,{top:c.height/2-120,left:c.width/2-213,sourceWidth:c.width,sourceHeight:c.height,minWidth:426,maxWidth:426,downsamplingRatio:.5});n.toBlob(function(e){axios({method:"POST",url:"https://westus.api.cognitive.microsoft.com/emotion/v1.0/recognize",headers:{"Content-Type":"application/octet-stream","Ocp-Apim-Subscription-Key":EMOTION_API_KEY},data:e}).then(function(e){console.log(e)}).catch(function(e){console.log(e)})});var i=document.createElement("img");i.src=n.toDataURL("image/png"),document.getElementById("js-media_Src").appendChild(i)}),r.addEventListener("dragover",function(e){e.preventDefault(),r.classList.add("media-Resource-dragover"),e.dataTransfer.dropEffect="copy"}),r.addEventListener("dragleave",function(e){e.preventDefault(),r.classList.remove("media-Resource-dragover")}),r.addEventListener("drop",v)};y(),function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function e(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,p();case 3:return f=r.sent,a.video.facingMode=n[0],r.next=7,navigator.mediaDevices.getUserMedia(a);case 7:return i=r.sent,r.next=10,w();case 10:t=r.sent,y(),o.srcObject=i,function e(){l.drawImage(o,0,0,c.width,c.height),requestAnimationFrame(e)}(),r.next=19;break;case 16:r.prev=16,r.t0=r.catch(0),console.log(r.t0);case 19:case"end":return r.stop()}},e,this,[[0,16]])}));return e}()()},!1)}();